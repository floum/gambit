Repertoire : <%= @repertoire.name %>

<div class="row text-center">
    <div id="chessboard" class="blue merida"></div>
</div>

<br />
<div class="text-center">
  <%= button_tag 'Add To Repertoire', id: 'submit' %>
</div>

<script type="module">

import { Chessground } from 'chessground'
import { Chess } from 'chess.js'

let game = new Chess();

var board = Chessground(document.getElementById('chessboard'), {
  orientation: '<%= @repertoire.color %>',
  movable: {
    events: {
      after: (orig, dest, metadata) => {
        try {
          game.move({from: orig, to: dest})
        } catch (error) {
          board.set({
            fen: game.fen()
          })
        }
      }
    }
  }
})

function go() {
  let history = game.history({verbose: true})
  board.set({
    fen: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1'
  })
  game.load('rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1')
}
document.getElementById('submit').addEventListener('click', go)
</script>
