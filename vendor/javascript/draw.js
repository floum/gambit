import{unselect as e,cancelMove as o,whitePov as r,getKeyAtDomPos as a,getSnappedKeyAtDomPos as s}from"./board.js";import{eventPosition as n,isRightButton as t}from"./util.js";import"./premove.js";import"./types.js";const d=["green","red","blue","yellow"];function start(s,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation();t.preventDefault();t.ctrlKey?e(s):o(s);const d=n(t),i=a(d,r(s),s.dom.bounds());if(i){s.drawable.current={orig:i,pos:d,brush:eventBrush(t),snapToValidMove:s.drawable.defaultSnapToValidMove};processDraw(s)}}function processDraw(e){requestAnimationFrame((()=>{const o=e.drawable.current;if(o){const n=a(o.pos,r(e),e.dom.bounds());n||(o.snapToValidMove=false);const t=o.snapToValidMove?s(o.orig,o.pos,r(e),e.dom.bounds()):n;if(t!==o.mouseSq){o.mouseSq=t;o.dest=t!==o.orig?t:void 0;e.dom.redrawNow()}processDraw(e)}}))}function move(e,o){e.drawable.current&&(e.drawable.current.pos=n(o))}function end(e){const o=e.drawable.current;if(o){o.mouseSq&&addShape(e.drawable,o);cancel(e)}}function cancel(e){if(e.drawable.current){e.drawable.current=void 0;e.dom.redraw()}}function clear(e){if(e.drawable.shapes.length){e.drawable.shapes=[];e.dom.redraw();onChange(e.drawable)}}function eventBrush(e){var o;const r=(e.shiftKey||e.ctrlKey)&&t(e);const a=e.altKey||e.metaKey||((o=e.getModifierState)===null||o===void 0?void 0:o.call(e,"AltGraph"));return d[(r?1:0)+(a?2:0)]}function addShape(e,o){const sameShape=e=>e.orig===o.orig&&e.dest===o.dest;const r=e.shapes.find(sameShape);r&&(e.shapes=e.shapes.filter((e=>!sameShape(e))));r&&r.brush===o.brush||e.shapes.push({orig:o.orig,dest:o.dest,brush:o.brush});onChange(e)}function onChange(e){e.onChange&&e.onChange(e.shapes)}export{cancel,clear,end,move,processDraw,start};
//# sourceMappingURL=draw.js.map
